#include <Arduino.h>

#include "len.h"

namespace
{

const int SIZE = 3;
const int ADDRESS_PINS[SIZE * SIZE] = {2, 4, 7, 8, 9, 10, 11, 12, 13};
const int GROUND_PINS[SIZE] = {3, 5, 6};

void reset()
{
    for (const auto pin : ADDRESS_PINS)
    {
        digitalWrite(pin, 0);
    }

    for (const auto pin : GROUND_PINS)
    {
        digitalWrite(pin, 1);
    }
}

} // anonymous namespace

void setup()
{
    for (const auto pin : ADDRESS_PINS)
    {
        pinMode(pin, OUTPUT);
    }

    for (const auto pin : GROUND_PINS)
    {
        pinMode(pin, OUTPUT);
    }

    reset();
    Serial.begin(9600);
}

using Cube3 = Cube<SIZE>;

Cube3 scan[]
{
    Cube3({0b000'000'000,
           0b000'000'000,
           0b000'000'001}),

    Cube3({0b000'000'000,
           0b000'000'001,
           0b000'000'000}),

    Cube3({0b000'000'001,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'001'000,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b000'001'000,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b000'001'000}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b001'000'000}),

    Cube3({0b000'000'000,
           0b001'000'000,
           0b000'000'000}),

    Cube3({0b001'000'000,
           0b000'000'000,
           0b000'000'000}),

    // layer 2
    Cube3({0b010'000'000,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b010'000'000,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b010'000'000}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b000'010'000}),

    Cube3({0b000'000'000,
           0b000'010'000,
           0b000'000'000}),

    Cube3({0b000'010'000,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'000'010,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b000'000'010,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b000'000'010}),

    // layer 3
    Cube3({0b000'000'000,
           0b000'000'000,
           0b000'000'100}),

    Cube3({0b000'000'000,
           0b000'000'100,
           0b000'000'000}),

    Cube3({0b000'000'100,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'100'000,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b000'100'000,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b000'100'000}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b100'000'000}),

    Cube3({0b000'000'000,
           0b100'000'000,
           0b000'000'000}),

    Cube3({0b100'000'000,
           0b000'000'000,
           0b000'000'000}),

};

Cube3 orbit[]
{
    Cube3({0b000'000'000,
           0b000'000'000,
           0b100'000'001}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b000'101'000}),

    Cube3({0b000'000'000,
           0b000'000'000,
           0b001'000'100}),

    Cube3({0b000'000'000,
           0b010'000'010,
           0b000'000'000}),

    Cube3({0b100'000'001,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'101'000,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b001'000'100,
           0b000'000'000,
           0b000'000'000}),

    Cube3({0b000'000'000,
           0b010'000'010,
           0b000'000'000}),

};

Cube3 circles[]
{
    Cube3({0b100'000'000,
           0b000'000'000,
           0b000'000'001}),

    Cube3({0b000'000'000,
           0b100'000'001,
           0b000'000'000}),

    Cube3({0b000'000'001,
           0b000'000'000,
           0b100'000'000}),

    Cube3({0b000'000'010,
           0b000'000'000,
           0b010'000'000}),

    Cube3({0b000'000'100,
           0b000'000'000,
           0b001'000'000}),

    Cube3({0b000'000'000,
           0b001'000'100,
           0b000'000'000}),

    Cube3({0b001'000'000,
           0b000'000'000,
           0b000'000'100}),

    Cube3({0b010'000'000,
           0b000'000'000,
           0b000'000'010}),

};

void loop()
{
    auto& frames = circles;
    static const unsigned long frameDuration = 100;
    unsigned long start = millis();
    int frame = 0;
    while (frame < len(frames))
    {
        frames[frame].write(ADDRESS_PINS, GROUND_PINS);
        
        unsigned long time = millis();
        if (time >= start + frameDuration)
        {
            ++frame;
            start = time;
        }
    }
}
